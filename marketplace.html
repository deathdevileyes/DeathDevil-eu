<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Marktplatz ‚Äì DeathDevil.Eu</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.cdnfonts.com/css/minecraft-4" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Minecraft', monospace;
  background: #0b0d10;
  color: #eaeaea;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 18px 30px;
  background: rgba(0,0,0,0.85);
  border-bottom: 1px solid #6e0a16;
}

header a {
  color: #2ecc71;
  text-decoration: none;
}

.alarm {
  background: rgba(20,20,25,0.85);
  border: 1px solid #6e0a16;
  padding: 10px 14px;
  box-shadow: 0 0 15px rgba(177,18,38,0.6);
  font-size: 12px;
  max-width: 200px;
}

h1 {
  text-align: center;
  margin: 35px 0 10px;
  color: #2ecc71;
}

.hint {
  text-align: center;
  color: #a0a0a0;
  margin-bottom: 30px;
  font-size: 14px;
}

/* SEARCH + FILTER */
.controls {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 12px;
  margin-bottom: 35px;
}

.controls input,
.controls select,
.controls button {
  background: rgba(20,20,25,0.9);
  border: 1px solid #6e0a16;
  color: #eaeaea;
  font-family: 'Minecraft', monospace;
  padding: 10px 14px;
}

.controls button {
  cursor: pointer;
}

.controls button.active {
  border-color: #2ecc71;
}

/* GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px,1fr));
  gap: 24px;
  padding: 0 40px 80px;
  max-width: 1300px;
  margin: auto;
}

.item {
  background: rgba(20,20,25,0.85);
  border: 1px solid #6e0a16;
  padding: 18px;
  text-align: center;
  box-shadow: 0 0 15px rgba(177,18,38,0.6);
}

.item span {
  display: block;
  margin: 10px 0;
}

/* TOP DEAL */
.item.deal {
  border-color: #2ecc71;
  box-shadow: 0 0 25px rgba(46,204,113,0.9);
}
</style>
</head>

<body>

<header>
  <div class="alarm" id="alarmLeft">‚è≥ Preisalarm‚Ä¶</div>
  <a href="index.html">‚¨Ö Startseite</a>
  <div class="alarm" id="alarmRight">‚è≥ Preisalarm‚Ä¶</div>
</header>

<h1>üõí Server-Marktplatz</h1>
<div class="hint">
‚ÑπÔ∏è Preise √§ndern sich <b>automatisch t√§glich</b>.<br>
üî• Top-Deals werden hervorgehoben.
</div>

<!-- CONTROLS -->
<div class="controls">
  <input id="searchInput" placeholder="üîç Item suchen‚Ä¶">
  
  <select id="sortSelect">
    <option value="default">Sortierung</option>
    <option value="asc">Preis ‚Üë</option>
    <option value="desc">Preis ‚Üì</option>
  </select>

  <button data-cat="all" class="active">Alle</button>
  <button data-cat="Erze">Erze</button>
  <button data-cat="Farm">Farm</button>
  <button data-cat="Nether">Nether</button>
  <button data-cat="End">End</button>
</div>

<div class="grid" id="market"></div>

<script>
let allItems = [];
let currentCategory = "all";

fetch(window.location.origin + "/prices.json")
  .then(res => {
    if (!res.ok) throw new Error("HTTP " + res.status);
    return res.json();
  })
  .then(data => {
    allItems = data.items.map(i => ({
      ...i,
      category: i.category || "Sonstiges"
    }));
    render();
    updateAlarm();
  })
  .catch(err => {
    console.error("FEHLER:", err);
    document.getElementById("market").innerHTML =
      "<p style='grid-column:1/-1;text-align:center;color:red'>‚ùå Preise konnten nicht geladen werden</p>";
  });

const market = document.getElementById("market");
const searchInput = document.getElementById("searchInput");
const sortSelect = document.getElementById("sortSelect");
const buttons = document.querySelectorAll(".controls button");

buttons.forEach(btn => {
  btn.onclick = () => {
    buttons.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    currentCategory = btn.dataset.cat;
    render();
  };
});

searchInput.oninput = render;
sortSelect.onchange = render;

function render() {
  let items = [...allItems];

  const q = searchInput.value.toLowerCase();
  if (q) items = items.filter(i => i.name.toLowerCase().includes(q));

  if (currentCategory !== "all") {
    items = items.filter(i => i.category === currentCategory);
  }

  if (sortSelect.value === "asc")
    items.sort((a,b)=>a.price-b.price);
  if (sortSelect.value === "desc")
    items.sort((a,b)=>b.price-a.price);

  market.innerHTML = "";

  if (!items.length) {
    market.innerHTML =
      "<p style='grid-column:1/-1;text-align:center;color:#a0a0a0'>‚ùå Keine Items gefunden</p>";
    return;
  }

  const cheapest = [...items].sort((a,b)=>a.price-b.price)[0];

  items.forEach(i => {
    const div = document.createElement("div");
    div.className = "item" + (i === cheapest ? " deal" : "");
    div.innerHTML = `
      ${i.icon}
      <span>${i.amount}√ó ${i.name}</span>
      <b>${i.price.toFixed(2)} ‚Ç¨</b>
    `;
    market.appendChild(div);
  });
}

function updateAlarm() {
  const best = [...allItems].sort((a,b)=>a.price-b.price).slice(0,2);
  document.getElementById("alarmLeft").innerHTML =
    `üî• ${best[0].name}<br>${best[0].price.toFixed(2)} ‚Ç¨`;
  document.getElementById("alarmRight").innerHTML =
    `üíé ${best[1].name}<br>${best[1].price.toFixed(2)} ‚Ç¨`;
}
</script>

</body>
</html>

